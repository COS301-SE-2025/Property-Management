<app-header />

<div class="px-10 py-8">
  <h2 class="text-2xl font-bold mb-2">Create New Property</h2>
  <div class="h-1 w-64 bg-yellow-400 mb-6"></div>

  <div
    [ngClass]="{
      'border rounded-lg p-12 shadow-sm max-w-6xl mx-auto': true,
      'bg-#3d444d border-black text-black': !isDarkMode,
      'bg-#2b3036 border-white text-white': isDarkMode
    }"
  >
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">
      
      <!-- Property Name -->
      <div class="mb-8">
        <p-floatlabel>
          <input 
            id="name" 
            pInputText 
            formControlName="name" 
            class="w-full" 
            [class.ng-invalid]="form.get('name')?.invalid && form.get('name')?.touched"
            [style]="{ width: '100%' }"
          />
          <label for="name">Property Name *</label>
        </p-floatlabel>
        <small class="text-red-500" *ngIf="form.get('name')?.invalid && form.get('name')?.touched">
          Property name is required.
        </small>
      </div>

      <!-- Property Type -->
      <div class="mb-8">
        <p-floatlabel>
          <input 
            id="type" 
            pInputText 
            formControlName="type" 
            class="w-full"
            [class.ng-invalid]="form.get('type')?.invalid && form.get('type')?.touched"
            [style]="{ width: '100%' }"
          />
          <label for="type">Property Type *</label>
        </p-floatlabel>
        <small class="text-red-500" *ngIf="form.get('type')?.invalid && form.get('type')?.touched">
          Property type is required.
        </small>
      </div>

      <!-- Area and Property Value Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>
          <p-floatlabel>
            <input 
              id="area" 
              pInputText 
              formControlName="area" 
              type="number" 
              min="0" 
              step="0.01" 
              class="w-full"
              [class.ng-invalid]="form.get('area')?.invalid && form.get('area')?.touched"
              [style]="{ width: '100%' }"
            />
            <label for="area">Area (mÂ²) *</label>
          </p-floatlabel>
          <small class="text-red-500" *ngIf="form.get('area')?.invalid && form.get('area')?.touched">
            Area is required and must be greater than 0.
          </small>
        </div>

        <div>
          <p-floatlabel>
            <input 
              id="propertyValue" 
              pInputText 
              formControlName="propertyValue" 
              type="number" 
              min="0" 
              step="0.01" 
              class="w-full"
              [class.ng-invalid]="form.get('propertyValue')?.invalid && form.get('propertyValue')?.touched"
              [style]="{ width: '100%' }"
            />
            <label for="propertyValue">Property Value *</label>
          </p-floatlabel>
          <small class="text-red-500" *ngIf="form.get('propertyValue')?.invalid && form.get('propertyValue')?.touched">
            Property value is required and must be greater than 0.
          </small>
        </div>
      </div>

      <!-- Primary Contractor -->
      <div class="mb-8">
        <label for="primaryContractor" class="block mb-2 font-medium">Primary Contractor *</label>
        
        <p-dropdown 
          id="primaryContractor" 
          [options]="contractors" 
          optionLabel="name" 
          optionValue="uuid"
          formControlName="primaryContractor"
          [filter]="true" 
          [showClear]="true" 
          placeholder="Select a contractor"
          class="w-full"
          [class.ng-invalid]="form.get('primaryContractor')?.invalid && form.get('primaryContractor')?.touched"
          [style]="{ width: '100%' }">

          <ng-template pTemplate="item" let-contractor>
            <div class="flex items-center gap-2">
              <img src="assets/images/contractor-logo.png" alt="Logo" class="w-5 h-5" />
              <span>{{ contractor.name }} - {{ contractor.services }}</span>
            </div>
          </ng-template>

          <ng-template pTemplate="selectedItem" let-contractor>
            <div class="flex items-center gap-2">
              <img src="assets/images/contractor-logo.png" alt="Logo" class="w-5 h-5" *ngIf="contractor" />
              <span *ngIf="contractor">{{ contractor.name }}</span>
              <span *ngIf="!contractor">Select a contractor</span>
            </div>
          </ng-template>

        </p-dropdown>
        <small class="text-red-500" *ngIf="form.get('primaryContractor')?.invalid && form.get('primaryContractor')?.touched">
          Primary contractor is required.
        </small>
      </div>

      <!-- Address Fields -->
      <div class="mb-8">
        <p-floatlabel>
          <input 
            id="address" 
            pInputText 
            formControlName="address" 
            class="w-full"
            [class.ng-invalid]="form.get('address')?.invalid && form.get('address')?.touched"
            [style]="{ width: '100%' }"
          />
          <label for="address">Street Address *</label>
        </p-floatlabel>
        <small class="text-red-500" *ngIf="form.get('address')?.invalid && form.get('address')?.touched">
          Street address is required.
        </small>
      </div>

      <!-- Suburb and City Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <div>
          <p-floatlabel>
            <input 
              id="suburb" 
              pInputText 
              formControlName="suburb" 
              class="w-full"
              [style]="{ width: '100%' }"
            />
            <label for="suburb">Suburb</label>
          </p-floatlabel>
        </div>

        <div>
          <p-floatlabel>
            <input 
              id="city" 
              pInputText 
              formControlName="city" 
              class="w-full"
              [style]="{ width: '100%' }"
            />
            <label for="city">City</label>
          </p-floatlabel>
        </div>
      </div>

      <!-- Province -->
      <div class="mb-8">
        <p-floatlabel>
          <input 
            id="province" 
            pInputText 
            formControlName="province" 
            class="w-full"
            [style]="{ width: '100%' }"
          />
          <label for="province">Province</label>
        </p-floatlabel>
      </div>

      <!-- Property Image Upload -->
      <div class="mb-8">
        <label class="block mb-2 font-medium">Property Image (optional)</label>
        <input 
          type="file" 
          accept="image/*"
          (change)="onFileSelected($event)"
          class="w-full p-2 border border-gray-300 rounded-md"
        />
        <small class="text-gray-500">Supported formats: JPEG, PNG, GIF, WebP</small>
      </div>

      <!-- Error Message -->
      <div *ngIf="submissionError" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ submissionError }}
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end">
        <button 
          type="submit" 
          class="bg-yellow-400 text-black px-8 py-3 rounded-lg hover:bg-yellow-500 transition-colors font-medium flex items-center gap-2"
          [disabled]="form.invalid || isSubmitting"
          [class.opacity-50]="form.invalid || isSubmitting"
          [class.cursor-not-allowed]="form.invalid || isSubmitting">
          <span *ngIf="isSubmitting" class="animate-spin inline-block w-4 h-4 border-2 border-black border-t-transparent rounded-full"></span>
          {{ isSubmitting ? 'Creating...' : 'Create Property' }}
        </button>
      </div>

    </form>
  </div>
</div>